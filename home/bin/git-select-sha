#!/usr/bin/env bash

# Fuzzy selector for git commit hash ("sha")
# pipes it through `fzf` with color,
# slices out the selected hash and pipes it to pbcopy
#
# Usage:
#   git select-sha

set -e

# fuzzy-select a commit
target_commit="$(git log --format=select --color=always --no-merges | \
  fzf --ansi --no-sort --reverse --tiebreak=index)"

# slice out the SHA
commit_sha="$(echo "$target_commit" | sed -E 's/.*([a-f0-9]{7}).*/\1/')"

if [[ ! -z "$commit_sha" ]]; then
  echo "$commit_sha"
fi
