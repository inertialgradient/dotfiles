#!/usr/bin/env bash

# Fuzzy select a git commit hash or list of hashes.
# Print to stdout as a space-separated list.
#
# Usage:
#   git select-sha

set -e

# fuzzy-select a commit
target_commit="$(
    git log --format=select --color=always |\
    fzf --ansi \
        --no-sort \
        --reverse \
        --tiebreak=index \
        --bind 'ctrl-n:preview-down,ctrl-p:preview-up' \
        $1 \
        --preview='git show --color {+1}'
)"

# slice out the SHA
commit_sha="$(
    echo "$target_commit" |\
    awk '{ print $1 }'    |\
    tr '\n' ' '           |\
    awk '{$1=$1};1'
)"

if [[ ! -z "$commit_sha" ]]; then
    echo "$commit_sha"
fi
