#!/usr/bin/env ruby

# frozen_string_literal: true

require "fileutils"

BLACKLIST =
  File
  .readlines("#{ENV.fetch('XDG_CONFIG_HOME')}/dotfiles-cleanup/ignore")
  .map(&:chomp)
  .to_set
  .freeze

deletions = []

%w[.config .state .local .cache .emacs.d .viminfo .yarnrc .zsh_history .python_history .gem .hex]
  .map { |dir| [Dir.home, dir].join("/") }
  .select { |dir| File.directory?(dir) }
  .each { |dir| deletions.concat([dir], Dir.glob("#{dir}/**/*"))}
  .each { |dir| FileUtils.rm_rf(dir) }

deletions.map! { |deletion| deletion.sub(Dir.home, "~") }

if deletions.any?
  puts("Deleted:", deletions)
else
  puts("No deletable files found. No deletions.")
end
