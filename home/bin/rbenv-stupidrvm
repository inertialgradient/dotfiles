#!/usr/bin/env bash

# Quietly replace a redundant .ruby-version generated by RVM
# with a more concise one, to quiet rbenv's warnings
#
# For ruby projects that use RVM

git_dir="$(git rev-parse --git-dir)"
project_root="$(git rev-parse --show-toplevel)"

# Don't track changes to the .ruby-version file
echo '.ruby-version' >> "$git_dir"/info/exclude

# strip extraneous `ruby-` prefix
ruby_version="$(sed 's/ruby-//' < .ruby-version)"

# replace .ruby-version with less redundant version
echo "$ruby_version" > "$project_root"/.ruby-version

# None of this ever happened
git update-index --assume-unchanged .ruby-version
