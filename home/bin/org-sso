#!/usr/bin/env bash

set -e

controller_name="$1"
sanitized_controller_name=$(org-sanitize-controller-name "$controller_name")

# Update master
git pull origin master

# Check out a new branch
git checkout -b "org-idm/$sanitized_controller_name"

# Make trivial changes, add test template
org-sso-scaffold "$controller_name"

# Stage files and commit
git add --all
git commit --no-verify -m "Enforce SAML SSO on $controller_name [ci skip]"

# Push branch to remote
git push -u origin "org-idm/$sanitized_controller_name"

# Generate PR body and copy to clipboard
org-sso-generate-pr "$controller_name"

# Open a PR
hub pr

