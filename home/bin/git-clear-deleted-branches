#!/usr/bin/env bash

# Deletes all local branches that are gone on the given remote (default: origin)
#
# Excludes `master` and any branch beginning with a `!`.
#
# Examples:
#   git clear-deleted-branches [REMOTE]

function git_branches() {
  [[ "$1" == "all" ]] && local all="--all"

  git branch --no-verbose --no-color $all |\
    sed -E 's/^\**\s*//' |\
    grep -E --invert-match 'master|^!'
}

remote="${1:-origin}"

for local_branch in $(git_branches); do
  if ! git_branches "all" | grep -q "^remotes/$remote/$local_branch$"; then
    git branch -D "$local_branch"
  fi
done
