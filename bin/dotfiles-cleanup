#!/usr/bin/env ruby

# frozen_string_literal: true

require "fileutils"

BLACKLIST =
  File
  .readlines("#{ENV.fetch('XDG_CONFIG_HOME')}/dotfiles-cleanup/ignore")
  .map(&:chomp)
  .to_set
  .freeze

deletions = []

blacklist = <<~STR.strip.split("\n")

.cache
.config
.emacs.d
.gem
.hex
.local
.python_history
.rubies
.state
.viminfo
.yarnrc
.zsh_history

STR

blacklist
  .map { |dir| [Dir.home, dir].join("/") }
  .select { |dir| File.directory?(dir) }
  .each { |dir| deletions.concat([dir], Dir.glob("#{dir}/**/*"))}
  .each { |dir| FileUtils.rm_rf(dir) }

deletions.map! { |deletion| deletion.sub(Dir.home, "~") }

if deletions.any?
  puts("Deleted:", deletions)
else
  puts("No deletable files found. No deletions.")
end
