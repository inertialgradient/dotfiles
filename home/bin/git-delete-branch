#!/usr/bin/env bash

# Delete local and remote branch `name`:
#
# Usage: git delete-branch [rem]

branch="$(git branch | cut -c 3- | fzf)"
test -z "$branch" && exit 0

remote="$(git config branch.$branch.remote)"
test -z "$remote" && remote="origin"

ref="$(git config branch.$branch.merge)"
test -z $ref && ref="refs/heads/$branch"

# delete local branch
git branch -D $branch

# delete remote branch if `rem` passed
if [[ $1 == "rem" ]]; then
  # delete local remote-tracking reference
  git branch -d -r $remote/$branch

  # delete the remote branch
  git push $remote :$ref
fi
