#!/usr/bin/env bash

# Commit staged changes, marking them to be squashed to a commit fuzzy-selected
#
# Usage:
#   git commit-squash

# fuzzy-select the commit to be squashed into
target_commit="$(git log -20 --format=select --color=always --graph --all | \
  fzf --ansi --no-sort --reverse --tiebreak=index)"

# slice out the SHA
commit_sha="${target_commit:0:7}"


if [[ $commit_sha =~ ^[0-9a-z]{7}$ ]]; then
  # create a squash-commit if target commit selected
  git commit --squash $commit_sha
fi
